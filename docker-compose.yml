services:
  frontend:
    image: syferie/markhub-frontend:latest
    container_name: markhub-frontend
    ports:
      - "3000:3000"
    environment:
      # å‰ç«¯åº”ç”¨è¿æ¥åç«¯APIæœåŠ¡æ—¶ä½¿ç”¨çš„åŸºç¡€URLã€‚
      # åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™åº”è¯¥æ˜¯ä½ åç«¯æœåŠ¡æœ€ç»ˆçš„ã€é€šè¿‡åå‘ä»£ç†æš´éœ²çš„å…¬å…±HTTPSåœ°å€ã€‚
      # ä¾‹å¦‚ï¼šhttps://your-domain.com æˆ– https://api.your-domain.com
      # æµè§ˆå™¨ä¸­è¿è¡Œçš„å‰ç«¯ä»£ç å°†ä½¿ç”¨æ­¤URLå‘åç«¯å‘èµ·APIè¯·æ±‚ã€‚
      - NEXT_PUBLIC_API_BASE_URL=https://your-domain.com
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - markhub-network

  backend:
    image: syferie/markhub-backend:latest
    container_name: markhub-backend
    ports:
      - "8090:8090"
    environment:
      # PocketBase æœåŠ¡è‡ªèº«çš„å…¬å¼€URLã€‚
      # ä¸»è¦ç”¨äºPocketBaseç”ŸæˆæŒ‡å‘è‡ªèº«çš„ç»å¯¹é“¾æ¥ï¼ˆä¾‹å¦‚ï¼Œåœ¨é‚®ä»¶éªŒè¯ã€å¯†ç é‡ç½®é“¾æ¥ä¸­ï¼‰ã€‚
      # åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™åº”è¯¥æ˜¯ä½ çš„åç«¯æœåŠ¡æœ€ç»ˆçš„ã€é€šè¿‡åå‘ä»£ç†æš´éœ²çš„å…¬å…±HTTPSåŸŸåã€‚
      # ä¾‹å¦‚ï¼šhttps://your-domain.com æˆ– https://api.your-domain.com
      # æ³¨æ„ï¼šæ­¤è®¾ç½®ä¸æ”¹å˜PocketBaseåœ¨å®¹å™¨å†…ç›‘å¬çš„åœ°å€å’Œç«¯å£ï¼ˆé»˜è®¤ä¸ºHTTP 0.0.0.0:8090ï¼‰ã€‚
      # HTTPSçš„ç»ˆæ­¢å’ŒåŸŸåè®¿é—®åº”ç”±å¤–éƒ¨åå‘ä»£ç†å¤„ç†ã€‚
      - POCKETBASE_URL=https://your-domain.com
      
      # âš ï¸ ã€å¿…é¡»é…ç½®ã€‘JWTå¯†é’¥ - ç”¨äºç”¨æˆ·è®¤è¯Tokenç­¾å
      # ğŸ” å¼ºçƒˆå»ºè®®ä½¿ç”¨32å­—ç¬¦ä»¥ä¸Šçš„éšæœºå¯†é’¥ï¼Œå¯ä»¥è®¿é—®ä»¥ä¸‹ç½‘å€ç”Ÿæˆï¼š
      # ğŸŒ https://passwords-generator.org/32-character
      # âŒ å¦‚æœæ£€æµ‹åˆ°ä½¿ç”¨é»˜è®¤å€¼ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆæ–°å¯†é’¥
      - JWT_SECRET=your_very_secure_jwt_secret_key_at_least_32_characters_long_change_this_in_production
      
      # âš ï¸ ã€å¿…é¡»é…ç½®ã€‘æ•æ„Ÿä¿¡æ¯åŠ å¯†å¯†é’¥ - ç”¨äºåŠ å¯†APIå¯†é’¥ç­‰æ•æ„Ÿé…ç½®
      # ğŸ” å¿…é¡»ä½¿ç”¨32å­—ç¬¦çš„éšæœºå¯†é’¥ï¼Œä¸JWT_SECRETä½¿ç”¨ä¸åŒçš„å€¼
      # ğŸŒ è¯·è®¿é—® https://passwords-generator.org/32-character ç”Ÿæˆ
      # âŒ å¦‚æœæ£€æµ‹åˆ°ä½¿ç”¨é»˜è®¤å€¼ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆæ–°å¯†é’¥
      - ENCRYPTION_KEY=your_32_character_encryption_key_change_this_in_production_env
    # é€šè¿‡æ˜¾å¼ä¼ é€’ --http å‚æ•°ï¼Œç¡®ä¿ PocketBase åœ¨å®¹å™¨å†…éƒ¨ç›‘å¬æ­£ç¡®çš„åœ°å€å’Œç«¯å£ï¼Œ
    # è€Œä¸å— POCKETBASE_URL ç¯å¢ƒå˜é‡å¯¹ç›‘å¬åœ°å€çš„æ„å¤–å½±å“ã€‚
    # POCKETBASE_URL ä»å°†ç”¨äºç”Ÿæˆå¤–éƒ¨å¯è®¿é—®çš„é“¾æ¥ã€‚
    command: ["go", "run", "main.go", "serve", "--http=0.0.0.0:8090"]
    volumes:
      # æŒä¹…åŒ–PocketBaseæ•°æ®åº“å’Œæ–‡ä»¶
      - pocketbase-data:/app/pb_data
    restart: unless-stopped
    networks:
      - markhub-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8090/api/health", "||", "exit", "1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

# å®šä¹‰æŒä¹…åŒ–å­˜å‚¨
volumes:
  # PocketBase æ•°æ®æŒä¹…åŒ–å­˜å‚¨
  pocketbase-data:
    driver: local

# å®šä¹‰ç½‘ç»œ
networks:
  markhub-network:
    driver: bridge