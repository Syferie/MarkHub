services:
  # MarkHub å‰ç«¯æœåŠ¡ (Next.js) - å¼€å‘ç¯å¢ƒ
  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
      target: development
    container_name: markhub-frontend-dev
    ports:
      - "3000:3000"
    environment:
      # å‰ç«¯è¿æ¥åˆ°åç«¯æœåŠ¡çš„APIåœ°å€
      # å¼€å‘ç¯å¢ƒï¼šæµè§ˆå™¨é€šè¿‡å®¿ä¸»æœºç«¯å£è®¿é—®åç«¯å®¹å™¨
      # æ³¨æ„ï¼šNEXT_PUBLIC_ å˜é‡ä¼šæš´éœ²ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ— æ³•è§£æDockerå†…éƒ¨æœåŠ¡å
      - NEXT_PUBLIC_API_BASE_URL=http://localhost:8090
    volumes:
      # æŒ‚è½½æºä»£ç ä»¥æ”¯æŒçƒ­é‡è½½
      - ./frontend:/app
      - /app/node_modules
      - /app/.next
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - markhub-network

  # MarkHub åç«¯æœåŠ¡ (Go + PocketBase) - å¼€å‘ç¯å¢ƒ
  backend:
    build:
      context: backend
      dockerfile: Dockerfile
      target: development
    container_name: markhub-backend-dev
    ports:
      - "8090:8090"
    environment:
      # å¼€å‘ç¯å¢ƒçš„PocketBase URL
      - POCKETBASE_URL=http://0.0.0.0:8090
      
      # ğŸ”§ å¼€å‘ç¯å¢ƒJWTå¯†é’¥ - ä»…ç”¨äºå¼€å‘æµ‹è¯•
      # ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨æ›´å¼ºçš„å¯†é’¥
      - JWT_SECRET=dev_jwt_secret_key_32_characters_long_for_development_only
      
      # ğŸ”§ å¼€å‘ç¯å¢ƒåŠ å¯†å¯†é’¥ - ä»…ç”¨äºå¼€å‘æµ‹è¯•  
      # ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨æ›´å¼ºçš„å¯†é’¥
      - ENCRYPTION_KEY=dev_encryption_key_32_chars_long
    volumes:
      # æŒ‚è½½æºä»£ç ä»¥æ”¯æŒçƒ­é‡è½½
      - ./backend:/app
      # æŒä¹…åŒ–å¼€å‘ç¯å¢ƒçš„æ•°æ®åº“
      - pocketbase-dev-data:/app/pb_data
    restart: unless-stopped
    networks:
      - markhub-network
    healthcheck:
      test: ["CMD", "sh", "-c", "wget --no-verbose --tries=1 --spider http://localhost:8090/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

# å®šä¹‰æŒä¹…åŒ–å­˜å‚¨
volumes:
  # å¼€å‘ç¯å¢ƒçš„PocketBaseæ•°æ®æŒä¹…åŒ–å­˜å‚¨
  pocketbase-dev-data:
    driver: local

# å®šä¹‰ç½‘ç»œ
networks:
  markhub-network:
    driver: bridge